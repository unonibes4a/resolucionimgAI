<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Imágenes Avanzado</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #222;
            color: #fff;
            display: flex;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .sidebar {
            background-color: #333;
            padding: 20px;
            width: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
            overflow-y: auto;
            max-height: 100vh;
        }

        .sidebar h2 {
            color: #272727;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 18px;
        }

        .sidebar-group {
            margin-bottom: 20px;
            width: 100%;
            text-align: center;
        }

        .sidebar-group label {
            font-size: 14px;
            color: #bbb;
            margin-bottom: 8px;
            display: block;
        }

        input[type="number"] {
            background-color: #444;
            border: 1px solid #555;
            border-radius: 20px;
            color: #fff;
            padding: 8px 12px;
            font-size: 14px;
            width: calc(100% - 30px);
            max-width: 120px;
            text-align: center;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #272727;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #272727;
            border-radius: 4px;
            background-color: #444;
            margin-right: 8px;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .checkbox-group input[type="checkbox"]:checked {
            background-color: #272727;
            border-color: #272727;
        }

        .checkbox-group input[type="checkbox"]:checked::after {
            content: '✓';
            color: #fff;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-group label {
            margin: 0;
            font-size: 14px;
            color: #fff;
            cursor: pointer;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: calc(100% - 30px);
            max-width: 120px;
            height: 6px;
            background: #555;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #272727;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #272727;
            cursor: pointer;
        }

        button {
            background-color: #272727;
            color: #fff;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px 0;
            width: calc(100% - 20px);
            max-width: 180px;
        }

        button:hover {
            background-color: #d6d6d6;
            transform: translateY(-1px);
                 color: #000000;
        }

        button:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        button.quality-btn {
            background-color: #353535;
        }

        button.quality-btn:hover {
            background-color: #7e7e7e;
        }

        button.remove-bg-btn {
            background-color: #4b4b4b;
        }

        button.remove-bg-btn:hover {
            background-color: #757575;
        }

        button.fill-black-btn {
            background-color: #1a1a1a;
        }

        button.fill-black-btn:hover {
            background-color: #404040;
        }

        button.copy-btn {
           background-color: #353535;
        }

        button.copy-btn:hover {
            background-color: #818181;
        }

        button.paste-btn {
                 background-color: #353535;
        }

        button.paste-btn:hover {
                 background-color: #353535;
        }

        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            overflow: auto;
        }

        .main-content h1 {
            color: #272727;
            margin-bottom: 25px;
            font-weight: 700;
            text-align: center;
        }

        .drop-area {
            border: 2px dashed #272727;
            border-radius: 10px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            font-size: 18px;
            color: #272727;
            background-color: #3a3a3a;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            width: 90%;
            max-width: 600px;
            box-sizing: border-box;
        }

        .drop-area.highlight {
            background-color: #4a4a4a;
            border-color: #272727;
        }

        canvas {
            border: 2px dashed #555;
            background-color: #444;
            margin-top: 20px;
            max-width: 100%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .section-divider {
            width: 100%;
            height: 1px;
            background-color: #555;
            margin: 15px 0;
        }

        .loading {
            display: none;
            color: #0097a7;
            font-size: 14px;
            margin: 10px 0;
        }
        canvas{
     width: 500px;  
  height: 500px;  
  object-fit: cover;  
  border: 1px solid rgb(255, 255, 255);  
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Controles</h2>
        
        <div class="sidebar-group">
            <label for="newWidth">Ancho:</label>
            <input type="number" id="newWidth" value="500">
        </div>
        <div class="sidebar-group">
            <label for="newHeight">Altura:</label>
            <input type="number" id="newHeight" value="300">
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="maintainAspectRatio" checked>
            <label for="maintainAspectRatio">Mantener Aspecto</label>
        </div>
        <button id="resizeBtn">Redimensionar</button>

        <div class="section-divider"></div>

        <button id="enhanceBtn" class="quality-btn">Mejorar Imagen</button>
        <button id="removeBgBtn" class="remove-bg-btn">Remover Fondo</button>
        <button id="fillBlackBtn" class="fill-black-btn">Fill Negro</button>
        <button id="copyBtn" class="copy-btn">Copiar Imagen</button>
        <button id="pasteBtn" class="paste-btn">Pegar Imagen</button>
        <div class="loading" id="loadingBg">Procesando...</div>

        <div class="section-divider"></div>

        <div class="sidebar-group">
            <label for="saturationSlider">Saturación: <span id="saturationValue">100</span></label>
            <input type="range" id="saturationSlider" min="0" max="200" value="100">
        </div>
        <div class="sidebar-group">
            <label for="brightnessSlider">Brillo: <span id="brightnessValue">100</span></label>
            <input type="range" id="brightnessSlider" min="0" max="200" value="100">
        </div>
        <div class="sidebar-group">
            <label for="hueSlider">Hue: <span id="hueValue">0</span></label>
            <input type="range" id="hueSlider" min="0" max="360" value="0">
        </div>
        <div class="sidebar-group">
            <label for="contrastSlider">Contraste: <span id="contrastValue">100</span></label>
            <input type="range" id="contrastSlider" min="0" max="200" value="100">
        </div>
        <div class="sidebar-group">
            <label for="blurSlider">Blur: <span id="blurValue">0</span></label>
            <input type="range" id="blurSlider" min="0" max="20" value="0">
        </div>

        <div class="section-divider"></div>

        <div class="sidebar-group">
            <label for="biasSlider">Bias: <span id="biasValue">10</span></label>
            <input type="range" id="biasSlider" min="1" max="100" value="10">
        </div>
        <div class="sidebar-group">
            <label for="strengthSlider">Fuerza: <span id="strengthValue">50</span></label>
            <input type="range" id="strengthSlider" min="0" max="100" value="50">
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="invertCheckbox">
            <label for="invertCheckbox">Invertir</label>
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="redChannelCheckbox" checked>
            <label for="redChannelCheckbox">R</label>
        </div>
        <div class="checkbox-group">
            <input type="checkbox" id="greenChannelCheckbox" checked>
            <label for="greenChannelCheckbox">G</label>
        </div>
        <button id="createNormalMapBtn">Crear Normal Map</button>

        <div class="section-divider"></div>

        <button id="applyFiltersBtn">Aplicar Filtros</button>
        <button id="resetFiltersBtn">Resetear Filtros</button>
        <button id="downloadBtn">Descargar Imagen</button>
    </div>

    <div class="main-content">
        <h1>Editor de Imágenes Avanzado</h1>
        <div class="drop-area" id="dropArea">
            Arrastra y suelta una imagen aquí, o pega desde el portapapeles.
        </div>
        <canvas id="myCanvas"></canvas>
    </div>

    <script type="module">
        import { removeBackground } from 'https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.6.0/+esm';

        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const newWidthInput = document.getElementById('newWidth');
        const newHeightInput = document.getElementById('newHeight');
        const maintainAspectRatioCheckbox = document.getElementById('maintainAspectRatio');
        const resizeBtn = document.getElementById('resizeBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const dropArea = document.getElementById('dropArea');
        const saturationSlider = document.getElementById('saturationSlider');
        const brightnessSlider = document.getElementById('brightnessSlider');
        const hueSlider = document.getElementById('hueSlider');
        const contrastSlider = document.getElementById('contrastSlider');
        const blurSlider = document.getElementById('blurSlider');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const enhanceBtn = document.getElementById('enhanceBtn');
        const removeBgBtn = document.getElementById('removeBgBtn');
        const fillBlackBtn = document.getElementById('fillBlackBtn');
        const copyBtn = document.getElementById('copyBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const loadingBg = document.getElementById('loadingBg');
        const biasSlider = document.getElementById('biasSlider');
        const strengthSlider = document.getElementById('strengthSlider');
        const invertCheckbox = document.getElementById('invertCheckbox');
        const redChannelCheckbox = document.getElementById('redChannelCheckbox');
        const greenChannelCheckbox = document.getElementById('greenChannelCheckbox');
        const createNormalMapBtn = document.getElementById('createNormalMapBtn');

        let originalImage = null;
        let originalImageData = null;
        let currentFile = null;
        let originalAspectRatio = 1;
        let currentSaturation = 100;
        let currentBrightness = 100;
        let currentHue = 0;
        let currentContrast = 100;
        let currentBlur = 0;

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.classList.add('highlight');
        }

        function unhighlight() {
            dropArea.classList.remove('highlight');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length === 0) return;
            const file = files[0];
            if (file.type.startsWith('image/')) {
                currentFile = file;
                const reader = new FileReader();
                reader.onload = function(event) {
                    loadImage(event.target.result);
                };
                reader.readAsDataURL(file);
            } else {
                alert('Por favor, suelta un archivo de imagen válido.');
            }
        }

        document.addEventListener('paste', (e) => {
            const items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.startsWith('image/')) {
                    const blob = items[i].getAsFile();
                    currentFile = blob;
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        loadImage(event.target.result);
                    };
                    reader.readAsDataURL(blob);
                    return;
                }
            }
            const text = e.clipboardData.getData('text/plain');
            if (text && (text.startsWith('http://') || text.startsWith('https://')) && /\.(jpeg|jpg|gif|png|webp|bmp)$/i.test(text)) {
                loadImage(text);
            }
        });

        function loadImage(src) {
            const img = new Image();
            img.onload = () => {
                originalImage = img;
                originalAspectRatio = img.width / img.height;

                canvas.width = img.width;
                canvas.height = img.height;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);

                originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

                newWidthInput.value = img.width;
                newHeightInput.value = img.height;

                resetFilters();
            };
            img.onerror = () => {
                alert('No se pudo cargar la imagen. Asegúrate de que la URL sea válida o que la imagen sea accesible.');
            };
            img.src = src;
        }

        newWidthInput.addEventListener('input', () => {
            if (maintainAspectRatioCheckbox.checked && originalImage) {
                const newWidth = parseInt(newWidthInput.value);
                if (!isNaN(newWidth) && newWidth > 0) {
                    newHeightInput.value = Math.round(newWidth / originalAspectRatio);
                }
            }
        });

        newHeightInput.addEventListener('input', () => {
            if (maintainAspectRatioCheckbox.checked && originalImage) {
                const newHeight = parseInt(newHeightInput.value);
                if (!isNaN(newHeight) && newHeight > 0) {
                    newWidthInput.value = Math.round(newHeight * originalAspectRatio);
                }
            }
        });

        resizeBtn.addEventListener('click', () => {
            if (!originalImage) {
                alert('Primero carga una imagen.');
                return;
            }

            let newWidth = parseInt(newWidthInput.value);
            let newHeight = parseInt(newHeightInput.value);

            if (isNaN(newWidth) || isNaN(newHeight) || newWidth <= 0 || newHeight <= 0) {
                alert('Por favor, introduce dimensiones válidas (números mayores que 0).');
                return;
            }

            if (maintainAspectRatioCheckbox.checked) {
                if (newWidthInput.value !== originalImage.width.toString() || newHeightInput.value === originalImage.height.toString()) {
                     newHeight = Math.round(newWidth / originalAspectRatio);
                     newHeightInput.value = newHeight;
                } else {
                     newWidth = Math.round(newHeight * originalAspectRatio);
                     newWidthInput.value = newWidth;
                }
            }

            canvas.width = newWidth;
            canvas.height = newHeight;

            applyFiltersToCanvas();
        });

        enhanceBtn.addEventListener('click', () => {
            if (!originalImage) {
                alert('Primero carga una imagen.');
                return;
            }
            
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            const scale = 2;
            tempCanvas.width = canvas.width * scale;
            tempCanvas.height = canvas.height * scale;
            
            tempCtx.imageSmoothingEnabled = true;
            tempCtx.imageSmoothingQuality = 'high';
            
            tempCtx.filter = 'contrast(110%) brightness(105%) saturate(110%)';
            tempCtx.drawImage(originalImage, 0, 0, tempCanvas.width, tempCanvas.height);
            
            canvas.width = tempCanvas.width;
            canvas.height = tempCanvas.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(tempCanvas, 0, 0);
            
            newWidthInput.value = canvas.width;
            newHeightInput.value = canvas.height;
        });

        removeBgBtn.addEventListener('click', async () => {
            if (!originalImage && !currentFile) {
                alert('Primero carga una imagen.');
                return;
            }
            
            loadingBg.style.display = 'block';
            loadingBg.textContent = 'Procesando...';
            removeBgBtn.disabled = true;
            
            try {
                let inputImage;
                
                if (currentFile) {
                    inputImage = currentFile;
                } else {
                    canvas.toBlob(async (blob) => {
                        if (!blob) {
                            throw new Error('No se pudo convertir canvas a blob');
                        }
                        await processRemoveBackground(blob);
                    }, 'image/png');
                    return;
                }
                
                await processRemoveBackground(inputImage);
                
            } catch (error) {
                loadingBg.textContent = 'Error al remover el fondo';
                alert('Error al remover el fondo. Intenta con otra imagen.');
            } finally {
                setTimeout(() => {
                    loadingBg.style.display = 'none';
                    loadingBg.textContent = 'Procesando...';
                    removeBgBtn.disabled = false;
                }, 2000);
            }
        });

        fillBlackBtn.addEventListener('click', () => {
            if (!originalImage) {
                alert('Primero carga una imagen.');
                return;
            }

            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');

            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;

            tempCtx.fillStyle = '#000000';
            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);

            tempCtx.drawImage(canvas, 0, 0);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(tempCanvas, 0, 0);
        });

        copyBtn.addEventListener('click', async () => {
            if (!originalImage) {
                alert('No hay imagen para copiar.');
                return;
            }

            try {
                canvas.toBlob(async (blob) => {
                    if (blob) {
                        await navigator.clipboard.write([
                            new ClipboardItem({
                                [blob.type]: blob
                            })
                        ]);
                        alert('Imagen copiada al portapapeles');
                    }
                }, 'image/png');
            } catch (error) {
                alert('Error al copiar la imagen: ' + error.message);
            }
        });

        pasteBtn.addEventListener('click', async () => {
            try {
                const clipboardItems = await navigator.clipboard.read();
                
                for (const clipboardItem of clipboardItems) {
                    for (const type of clipboardItem.types) {
                        if (type.startsWith('image/')) {
                            const blob = await clipboardItem.getType(type);
                            const url = URL.createObjectURL(blob);
                            currentFile = blob;
                            loadImage(url);
                            return;
                        }
                    }
                }
                
                alert('No se encontró ninguna imagen en el portapapeles');
                
            } catch (error) {
                alert('Error al pegar imagen: ' + error.message);
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'c') {
                e.preventDefault();
                copyBtn.click();
            }
            
            if (e.ctrlKey && e.key === 'v') {
                e.preventDefault();
                pasteBtn.click();
            }
        });

        async function processRemoveBackground(imageInput) {
            try {
                const blob = await removeBackground(imageInput, {
                    progress: (key, current, total) => {
                        const percentage = Math.round((current / total) * 100);
                        loadingBg.textContent = `Descargando ${key}: ${percentage}%`;
                    }
                });
                
                const url = URL.createObjectURL(blob);
                loadImage(url);
                loadingBg.textContent = 'Fondo removido exitosamente';
                
            } catch (error) {
                throw error;
            }
        }

        createNormalMapBtn.addEventListener('click', () => {
            if (!originalImageData) {
                alert('Primero carga una imagen.');
                return;
            }
            ctx.putImageData(originalImageData, 0, 0);
            createNormalMap();
        });

        function createNormalMap() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const newData = new Uint8ClampedArray(data.length);
            
            const bias = parseFloat(biasSlider.value) / 100.0;
            const strength = parseFloat(strengthSlider.value) / 10.0;
            const invertR = invertCheckbox.checked ? -1.0 : 1.0;
            const invertG = invertCheckbox.checked ? -1.0 : 1.0;
            const useRed = redChannelCheckbox.checked;
            const useGreen = greenChannelCheckbox.checked;
            
            for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    const index = (y * canvas.width + x) * 4;
                    
                    const d0 = getRedValue(data, x, y, canvas.width, canvas.height) / 255.0;
                    const d1 = getRedValue(data, x + 1, y, canvas.width, canvas.height) / 255.0;
                    const d2 = getRedValue(data, x - 1, y, canvas.width, canvas.height) / 255.0;
                    const d3 = getRedValue(data, x, y + 1, canvas.width, canvas.height) / 255.0;
                    const d4 = getRedValue(data, x, y - 1, canvas.width, canvas.height) / 255.0;
                    
                    let dx = (d2 - d1) * strength;
                    let dy = (d4 - d3) * strength;
                    
                    dx *= invertR;
                    dy *= invertG;
                    
                    const dz = 1.0 / Math.max(bias, 0.01);
                    
                    const length = Math.sqrt(dx * dx + dy * dy + dz * dz);
                    const normX = dx / length;
                    const normY = dy / length;
                    const normZ = dz / length;
                    
                    if (useRed) {
                        newData[index] = Math.floor(Math.max(0, Math.min(255, (normX * 0.5 + 0.5) * 255)));
                    } else {
                        newData[index] = data[index];
                    }
                    
                    if (useGreen) {
                        newData[index + 1] = Math.floor(Math.max(0, Math.min(255, (normY * 0.5 + 0.5) * 255)));
                    } else {
                        newData[index + 1] = data[index + 1];
                    }
                    
                    newData[index + 2] = Math.floor(Math.max(0, Math.min(255, (normZ * 0.5 + 0.5) * 255)));
                    newData[index + 3] = 255;
                }
            }
            
            const newImageData = new ImageData(newData, canvas.width, canvas.height);
            ctx.putImageData(newImageData, 0, 0);
        }

        function getRedValue(data, x, y, width, height) {
            if (x < 0 || x >= width || y < 0 || y >= height) {
                return 0;
            }
            const index = (y * width + x) * 4;
            return data[index];
        }

        applyFiltersBtn.addEventListener('click', applyFiltersToCanvas);
        resetFiltersBtn.addEventListener('click', resetFilters);

        function applyFiltersToCanvas() {
            if (!originalImage) {
                alert('Primero carga una imagen.');
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const filterString = `saturate(${currentSaturation}%) brightness(${currentBrightness}%) hue-rotate(${currentHue}deg) contrast(${currentContrast}%) blur(${currentBlur}px)`;
            ctx.filter = filterString;
            ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
            ctx.filter = 'none';
        }

        function resetFilters() {
            currentSaturation = 100;
            currentBrightness = 100;
            currentHue = 0;
            currentContrast = 100;
            currentBlur = 0;
            
            saturationSlider.value = 100;
            brightnessSlider.value = 100;
            hueSlider.value = 0;
            contrastSlider.value = 100;
            blurSlider.value = 0;
            biasSlider.value = 10;
            strengthSlider.value = 50;
            
            document.getElementById('saturationValue').textContent = '100';
            document.getElementById('brightnessValue').textContent = '100';
            document.getElementById('hueValue').textContent = '0';
            document.getElementById('contrastValue').textContent = '100';
            document.getElementById('blurValue').textContent = '0';
            document.getElementById('biasValue').textContent = '10';
            document.getElementById('strengthValue').textContent = '50';
            
            invertCheckbox.checked = false;
            redChannelCheckbox.checked = true;
            greenChannelCheckbox.checked = true;
            
            if (originalImageData) {
                ctx.putImageData(originalImageData, 0, 0);
            } else {
                applyFiltersToCanvas();
            }
        }

        saturationSlider.addEventListener('input', (e) => {
            currentSaturation = parseInt(e.target.value);
            document.getElementById('saturationValue').textContent = currentSaturation;
        });

        brightnessSlider.addEventListener('input', (e) => {
            currentBrightness = parseInt(e.target.value);
            document.getElementById('brightnessValue').textContent = currentBrightness;
        });

        hueSlider.addEventListener('input', (e) => {
            currentHue = parseInt(e.target.value);
            document.getElementById('hueValue').textContent = currentHue;
        });

        contrastSlider.addEventListener('input', (e) => {
            currentContrast = parseInt(e.target.value);
            document.getElementById('contrastValue').textContent = currentContrast;
        });

        blurSlider.addEventListener('input', (e) => {
            currentBlur = parseInt(e.target.value);
            document.getElementById('blurValue').textContent = currentBlur;
        });

        biasSlider.addEventListener('input', (e) => {
            document.getElementById('biasValue').textContent = e.target.value;
        });

        strengthSlider.addEventListener('input', (e) => {
            document.getElementById('strengthValue').textContent = e.target.value;
        });

        downloadBtn.addEventListener('click', () => {
            if (!originalImage) {
                alert('No hay imagen para descargar.');
                return;
            }
            const dataURL = canvas.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = dataURL;
            a.download = 'imagen_editada.png';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
    </script>
</body>
</html>
